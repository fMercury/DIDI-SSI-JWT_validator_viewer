<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Certificado</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
  </head>

  <body>
    <div class="container">
      <div class="mt-5">
        <div id="loading" class="text-center">
          Cargando y verificando certificado...
        </div>
        <div class="alert alert-danger d-none" role="alert">
          <strong>Error:</strong> <span></span>
          <p><pre><code></code></pre></p>
        </div>
      </div>
      <div id="certificado" class="d-none">
        <h1 class="display-4 p-3">Certificado</h1>
        <div class="card mt-2">
          <div class="card-body">
            <div class="cart-title text-center">
              <h5 id="issName"></h5>
              <small class="text-muted" id="iss"></small>
            </div>
            <ul class="list-group list-group-flush">
              <li class="list-group-item"><div class="row"><span class="col-2">Nombre:</span><span class="col-10" id="nombre"></span></div></li>
              <li class="list-group-item"><div class="row"><span class="col-2">Apellido:</span><span class="col-10" id="apellido"></span></div></li>
              <li class="list-group-item"><div class="row"><span class="col-2">Curso:</span> <span class="col-10" id="curso"></span></div></li>
              <li class="list-group-item"><div class="row"><span class="col-2">Duraci√≥n:</span> <span class="col-10" id="duracion"></span></div></li>
              <li class="list-group-item"><div class="row"><span class="col-2">Fecha fin:</span><span class="col-10" id="fecha_fin"></span></div></li>
              <li class="list-group-item">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod</li>
              <li class="list-group-item"><button class="btn btn-secondary" type="button" onclick="window.history.back()">Volver</button></li>
            </ul>
          </div>
        </div>
        <div class="card mt-2">
          <div class="card-body">
            <small class="text-muted" id="jwt"></small>
          </div>
        </div>
      </div>
    </div>
    <script src="js/jquery-3.4.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/custom.js"></script>
  </body>
  <script>
    $(document).ready(function () {
      var jwt = getParameterByName('jwt', document.location)
      $('#jwt').append(jwt)
      $.get("/api/credential_viewer/" + jwt, function (res) {
        console.log(res)
        $('#loading').addClass('d-none')
        if (res.status === 'success') {
          let didiserver = res.data.didiserver
          let iss = res.data.iss
          let name = res.data.name
          $('#iss').append(iss)
          $('#issName').append(name)
          $('#nombre').append(didiserver.nombre)
          $('#apellido').append(didiserver.apellido)
          $('#curso').append(didiserver.curso)
          $('#duracion').append(didiserver.duracion)
          $('#fecha_fin').append(didiserver.fecha_fin)
          $('#certificado').removeClass('d-none')
        } else {
          $('.alert').removeClass('d-none')
          let error = res.data
          $('.alert span').append(error.message)
          $('.alert code').append(JSON.stringify(error.decode, undefined, 2))
        }
      });
    });
  </script>
</html>